<!DOCTYPE
  html PUBLIC "-//W3C//DTD XHTML 1.0//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<!-- Progeny Proprietary Information
     Copyright 2000-2005 Progeny Systems Corporation. All Rights Reserved.
-->
<!--?xml-stylesheet type="text/xsl" href="preprocess.xsl"?--> 
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:form="http://www.w3.org/2002/xforms"
xmlns:xf="http://www.w3.org/2002/xforms" 
 
xmlns:hb="http://www.hb.co.uk/hblink"
xmlns:xbl="http://www.w3.org/ns/xbl"
xmlns:ev="http://www.w3.org/2001/xml-events" 
xml:lang="en">
  <head>
    <title>All Controls</title>

    <link rel="stylesheet" type="text/css" href="xforms.css" />
		<!-- CSS -->
		<style type="text/css">
			/* Bind implementation */
			input.watermark{
				binding: url("watermark.xml#watermark");
			}
		</style>
    <script type="text/javascript" src="../../gears_init.js"></script>
    <script type="text/javascript" src="../../formfacesG2.js"></script>
    <script type="text/javascript" src="../../xbl.js"></script>
    
<script type="text/javascript">
  //<![CDATA[

var HB = {};
HB.trigger = function(extObject, child){
	var parentObject = xform.getObjectForHtmlNode(xform.getHtmlNode(extObject.xmlNode.parentNode));
	var control      = parentObject.activeInstance.control; // parent control
	var sDocumentURI = child.getAttribute("xblbinding") || null;	
}

HB.xbl = function(extObject, child) {
setTimeout(function(){}, 0); // context switch flush out outstanding DOM creation
var bindingID = new XPath("//xbl:binding/@id").evaluate(child)[0].nodeValue;
//fOnWindowLoad2();
cXBLLanguage.process(child, location.href );
cElementXBL.prototype.addBinding.call(extObject, location.href+"#watermark");
//cElementXBL.prototype.addBinding
}
  XPath.DEFAULT_PREFIXES.setAttribute("xmlns:hb", "http://www.hb.co.uk/hblink");
  XPath.DEFAULT_PREFIXES.setAttribute("xmlns:xbl", "http://www.w3.org/ns/xbl");  
  var qqn = new QName('trigger');
  qqn.namespaceURI = "http://www.hb.co.uk/hblink";
  XForms.THIRD_PARTY_FUNCTIONS.registerFunction(qqn,HB.trigger); 
//
// register xbl processing
//
  qqn = new QName('xbl');
  qqn.namespaceURI = cXBLLanguage.namespaceURI;
  XForms.THIRD_PARTY_FUNCTIONS.registerFunction(qqn,HB.xbl);  
 
//]]>

</script>

    <form:model>
      <form:instance id="inst1">
        <data xmlns="">
          <value>grey</value>
        </data>
      </form:instance>
      <!--xf:action ev:event="xforms-ready" if="instance('inst1')/value == 'green' "-->
      <xf:message level="modal"  ev:event="xforms-ready" if="instance('inst1')/value = 'green' ">Change value to green to test condional processing</xf:message>
      <!--/xf:action-->
    </form:model>
  </head>

  <body>
<input type="text" class="watermark" />
    <p>
      <form:input ref="value" id="xbl1">
        <form:label>Input:</form:label>
        <form:extension>
        <hb:trigger>trigger</hb:trigger>
<xbl:xbl
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:xbl="http://www.w3.org/ns/xbl">

	<xbl:binding id="watermark">
		<xbl:implementation>
			({
			    "external"          : null,
				"xblBindingAttached":	function() {
				var oControl = this.boundElement; // points to extension control
            	var parentControl = xform.getObjectForHtmlNode(xform.getHtmlNode(oControl.xmlNode.parentNode)); // points to input
            	var htmlControl   =   xform.getHtmlNode(parentControl.xmlNode); // html of xf:input
            	alert('xblImplementation');
				},
      xblEnteredDocument: function() {
        
      },
      
      xblLeftDocument: function() {
        
      }
				
			})
		</xbl:implementation>
	</xbl:binding>
</xbl:xbl>
        </form:extension>
      </form:input>
</p>
    <p id="status">&nbsp;</p>
  </body>
</html>