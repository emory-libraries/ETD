
<!DOCTYPE                                              
 html PUBLIC "-//W3C//DTD XHTML 1.1//EN"               
 "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><!-- Progeny Proprietary Information
     Copyright 2000-2005 Progeny Systems Corporation. All Rights Reserved.
-->

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>FormFaces Release Instructions</title>

    <link rel="stylesheet" type="text/css" href="../Documentation/formfaces.css"/>

    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="fix-ie5.js"></script>
    <script type="text/javascript" src="ParseMaster.js"></script>
    <script type="text/javascript" src="pack.js"></script>

    <script type="text/javascript">
    // <![CDATA[
    
      var packaged,   packagedSize;
      var compressed, compressedSize;
      
      function getUriContents(uri) {
        try {
          var request = new XMLHttpRequest();
        }
        catch (e) {
          var request = new ActiveXObject("Microsoft.XMLHTTP");
        }
        
        request.open("GET", uri, false);
        request.send(null);
        
        if (request.status != 200 && request.status != 0) {
          throw "Error " + request.status + " loading " + uri + ": " + request.statusText;
        }
        
        return request.responseText;
      };
      
      function getPackagedSource() {
        var scriptPath = "../Source/";
        var lines      = getUriContents(scriptPath + "xforms.js").split("\n");
        var source     = "";
        
        for (var i in lines) {
          var line = lines[i];
        
          if (line.match(/^\s*"(.*)",?\s*$/)) {
            if (source != "") {
              source += "\n\n";
            }
          
            source += "// --- " + RegExp.$1 + " ---\n";
            source += getUriContents(scriptPath + RegExp.$1);
          }
        }
        
        return source;
      };
      
      function getCompressedSource() {
        return "// FormFaces (www.formfaces.com) is an open source XForms processor.\n"
             + "// Copyright (c) 2000-" + new Date().getFullYear() + " Progeny Systems Corporation.\n"
             + pack(packaged.value, 62, true, false);
      };
      
      function load() {
        packaged.value = getPackagedSource();
        recalculateSize(packaged, packagedSize);
        
      };
      
      function compress() {
        compressed.value = getCompressedSource();
        recalculateSize(compressed, compressedSize);
      };
      
      function recalculateSize(field, fieldSize) { 
        while (fieldSize.hasChildNodes()) {
          fieldSize.removeChild(fieldSize.firstChild);
        }
        
        var size = field.value.length;
        
        fieldSize.appendChild(document.createTextNode(addCommas(size)));
        fieldSize.appendChild(document.createTextNode(" byte" + (size == 1 ? "" : "s")));
      };
      
      function addCommas(number) {
        number = number.toString();
        
        for (var i = number.length - 3; i > 0; i -= 3) {
          number = number.substr(0, i) + "," + number.substr(i);
        }
        
        return number;
      };
      
      window.onload = function() {
        packaged       = document.getElementById("packaged");
        packagedSize   = document.getElementById("packaged-size");
        compressed     = document.getElementById("compressed");
        compressedSize = document.getElementById("compressed-size");
      
        recalculateSize(packaged,   packagedSize);
        recalculateSize(compressed, compressedSize);
        
        packaged  .onchange = function() { recalculateSize(packaged,   packagedSize);   };
        packaged  .onkeyup  = function() { recalculateSize(packaged,   packagedSize);   };
        compressed.onchange = function() { recalculateSize(compressed, compressedSize); };
        compressed.onkeyup  = function() { recalculateSize(compressed, compressedSize); };
      };
  
    // ]]>
    </script>
  </head>

  <body>
    <h2>How to package FormFaces:</h2>

    <ol>
      <li><strong>Make sure the <a href="../Documentation/status.html">compliance
          sheet</a> and <a href="../Documentation/patch-notes.html">patch notes</a> are
          up-to-date.</strong></li>
      
      <li>Checkout a release copy of FormFaces from CVS.</li>
      
      <li>Rename the <kbd>Platforms/Web</kbd> directory to <kbd>FormFaces</kbd>; this
          will be the root directory of the <kbd>.zip</kbd> file.</li>

      <li>Load and compress the source code (see below). Save the compressed source as
          <kbd>formfaces.js</kbd> in the root <kbd>FormFaces</kbd> directory.</li>
          
      <li>In the Documentation directory, pick the right license for the package, either <a href=
          "../Documentation/license-gpl.html">GPL</a> or <a href=
          "../Documentation/license-evaluation.html">commercial</a>. Rename this file to
          <kbd>license.html</kbd> and delete the other file.</li>
      
      <li>Create a file called <kbd>FormFaces
          (<i>YYYY</i>-<i>MM</i>-<i>DD</i>).zip</kbd>, and add the <kbd>FormFaces</kbd>
          directory to the archive. (Do not add the other platforms like .NET or Java).
          When users unzip the archive all the files should end up in a directory called
          <kbd>FormFaces</kbd>, with <kbd>formfaces.js</kbd> in that directory.</li>
    </ol>

    <p>
      <input type="button" value="Load"     onclick="load    ()"/>
      <input type="button" value="Compress" onclick="compress()"/>
    </p>

    <table><tr>
      <td>
        Packaged source (<span id="packaged-size"></span>):<br />
        <textarea id="packaged" rows="8" cols="50" wrap="off"></textarea>
      </td>
          
      <td>
        Compressed source (<span id="compressed-size"></span>):<br />
        <textarea id="compressed" rows="8" cols="50" wrap="soft"></textarea>
      </td>
    </tr></table>


    <h2>How to release FormFaces:</h2>

    <h3>Releasing on SourceForge</h3>
    
    <ol>
      <li>Package up FormFaces according to instructions above, for a GPL version.
          Rename the file to <kbd>FormFaces-<i>YYYY</i>-<i>MM</i>-<i>DD</i>.zip</kbd>
          </li>
          
      <li>Go to the <a href="https://sourceforge.net/project/admin/editpackages.php?group_id=135524"
          >File Release System</a> page on SourceForge and click on <a href=
          "https://sourceforge.net/project/admin/newrelease.php?package_id=148837&group_id=135524"
          >Add Release</a> at the bottom.</li>
          
      <li>Name the release <kbd>(<i>YYYY</i>-<i>MM</i>-<i>DD</i>)</kbd>.</li>
      
      <li>Add the notes from the change log to the text box that says "Paste The
          Change Log In". You'll need to check the "Preserve my pre-formatted text"
          checkbox and manually wordwrap the bullets.</li>
          
      <li>Click <b>Submit/Refresh</b> to save these changes.</li>
      
      <li>Upload the FormFaces <kbd>.zip</kbd> file you created in step 1 above
          according to the instructions in step 2. This file must be named as specified
          above with no spaces or special characters.</li>
          
      <li>Refresh the page and find the <kbd>.zip</kbd> file in the list. Select it,
          then push the "Add Files and/or Refresh View" button.</li>
          
      <li>Go to step 3; you should see the file here now. Choose
          "Platform-Independent" for the processor and ".zip" for the file type.</li>
          
      <li>Fin.</li>
      
      <li>Test the download process.</li>
    </ol>
    
    <h3>Releasing on FormFaces.com</h3>
    
    <ol>
      <li>Package up FormFaces according to instructions above, for an Evaluation
          version.</li>

      <li>If not already done, checkout the <kbd>FormFacesWebsite</kbd> module from
          <kbd>cvs.progeny.net</kbd>.</li>

      <li>Edit <kbd>main.html</kbd>, update "News FormFaces release X is
          now available." under news to be in accordance with the this release.</li>

      <li>Edit <kbd>downloads.html</kbd>, specifically the "New in this release"
          section.</li>

      <li>Edit <kbd>doDownload.html</kbd>, adding the latest release to the select
          box and making it the default selection.</li>

      <li><p>Edit <kbd>WEB-INF/src/com/riverform/formfaces/SendDownload.java</kbd>,
             adding code in for the latest release, replacing names as appropriate:</p>
             
          <p><code>
            if(request.getParameter("version").equals("FormFaces02_16_06")) {        <br />
            &nbsp;&nbsp;session.setAttribute("version","FormFaces (2006-02-16).zip");<br />
            }
          </code></p>
      </li>

      <li>Add the <kbd>.zip</kbd> file to the <kbd>downloads</kbd> directory.</li>

      <li>Run the Ant build file located in the <kbd>WEB-INF</kbd> directory, fixing
          any errors that crop up. It will create a <kbd>formfaces.war</kbd> file.</li>

      <li>Connect to Mojo via <i>Remote Desktop Connection</i>.</li>

      <li>Open the Services window (Start &rarr; Settings &rarr; Control Panel &rarr;
          Administrative Tools &rarr; Services).</li>
      
      <li><b>Stop</b> the Apache Service.</li>
      
      <li>Remove the <kbd>formfaces</kbd> folder from the <kbd>webapps</kbd> directory
          in Tomcat (<kbd>C:\Program Files\Apache Group\Tomcat 4.1\webapps</kbd>).</li>
      
      <li>Replace the <kbd>formfaces.war</kbd> file with the one created from the Ant
          build.</li>
      
      <li><p>Comment out these sections in <kbd>server.xml</kbd> for Tomcat, located
             in <kbd>C:\Program Files\Apache Group\Tomcat 4.1\config</kbd>. <b>Save</b>.</p>
             
          <p><code>
            &lt;Context path="/formfaces" docBase="formfaces" debug="0" reloadable="true" crossContext="true"&gt;<br />
            &nbsp;&nbsp;&lt;Realm  className="org.apache.catalina.realm.JDBCRealm" debug="99"                    <br />
            &nbsp;&nbsp;&nbsp;&nbsp;driverName="org.gjt.mm.mysql.Driver"                                         <br />
            &nbsp;&nbsp;&nbsp;&nbsp;connectionURL="jdbc:mysql://mojo:3306/formfaces?user=formfaces"              <br />
            &nbsp;&nbsp;&nbsp;&nbsp;connectionName="formfaces" connectionPassword="progenites"                   <br />
            &nbsp;&nbsp;&nbsp;&nbsp;userTable="users" userNameCol="username" userCredCol="password"              <br />
            &nbsp;&nbsp;&nbsp;&nbsp;userRoleTable="user_roles" roleNameCol="role" /&gt;                          <br />
            &lt;/Context&gt;
          </code></p>
          
          <p>And:</p>

          <p<code>
            &lt;Host name="www.formfaces.com" debug="0" appBase="webapps" unpackWARs="true"&gt;                                                                                                <br />
            &nbsp;&nbsp;&lt;Logger className="org.apache.catalina.logger.FileLogger" directory="logs" prefix="formfaces" suffix=".log" timestamp="true"/&gt;                                   <br />
            &nbsp;&nbsp;&lt;Context path="" docBase="formfaces" debug="0" reloadable="true"/&gt;                                                                                               <br />
            &nbsp;&nbsp;&lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs" prefix="formfaces_accesslog." suffix=".txt" pattern="common" resolveHosts="false"/&gt;<br />
            &lt;/Host&gt;
          </code></p>
      </li>
      
      <li><b>Start</b> the Apache service.</li>
      
      <li>Once Apache has started up and a new <kbd>formfaces</kbd> folder has been
          created in <kbd>C:\Program Files\Apache Group\Tomcat 4.1\webapps</kbd>, then
          <b>Stop</b> the Apache Service.</li>
          
      <li>Uncomment the lines above in <kbd>server.xml</kbd>. <b>Save</b>.</li>
      
      <li><b>Start</b> the Apache service.</li>
      
      <li>Disconnect from Mojo.</li>
      
      <li>Test the download process.</li>
    </ol>
  </body>
</html>
